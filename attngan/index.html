<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>voice2img</title>
</head>
<body>
    <h1>voice 2 image with AttnGAN</h1>
    <textarea name="input" id="input" cols="100" rows="10"></textarea>
    <br>
    <input type="button" onclick="record()" value="start">
    <input type="button" onclick="clearTextArea()" value="clear">
    <br>
    <h2>output</h2>
    <div id="output"></div>
    <script>
        window.SpeechRecognition = window.SpeechRecognition || webkitSpeechRecognition;
        const recognition = new webkitSpeechRecognition();
        recognition.lang = 'en';

        recognition.addEventListener('result', function(event){
            const text = event.results.item(0).item(0).transcript;
            document.getElementById('input').innerHTML = text;
            // send data
            postData();
        }, false);


        const Base64ToImage = (base64img, callback) => {
            const img = new Image();
            img.onload = () => {
                callback(img);
            };
            img.src = base64img;
        }

        

        
        const postData = async () => {
            console.time("timer");
            const url = "http://localhost:8000/query";
            const text = document.getElementById('input').value
            // const text = "test test";
            const input = {"caption": text};
            const settings = {
                method: 'POST',
                headers: {
                    Accept: 'application/json',
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(input),
            };
            const data = await fetch(url, settings)
                .then(response => response.json())
                .then(json => {
                    return json;
                })
                .catch(e => {
                    return e
                });
            
            console.log(`base64 \n ${data.result}`);
            console.timeEnd("timer");
            Base64ToImage(data.result, (img) => {
                document.getElementById('output').innerHTML ='';
                document.getElementById('output').appendChild(img);
            });
        }

        const record = ()=>{
            recognition.start();
            // postData()
        }
        const clearTextArea = () => {
            document.getElementById('input').value = "";
        }
    </script>
    <script src="./script.js"></script>
</body>
</html>